<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leaderboard Extended V1.1</title>

  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    h2 { margin-bottom: 10px; }
    .container {
      background: #fff; padding: 20px; border-radius: 12px;
      max-width: 1000px; margin: auto; box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    input, button {
      padding: 10px; margin: 5px 0; width: 100%;
      border-radius: 8px; border: 1px solid #ccc;
    }
    button { background: #0078ff; color: white; cursor: pointer; }

    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td {
      padding: 10px; border-bottom: 1px solid #ddd; text-align: left; vertical-align: top;
    }
    th { background: #0078ff; color: white; }

    .games-cell { font-size: 13px; color: #444; }

    .action-btn {
      padding: 6px 8px; font-size: 12px; border-radius: 6px;
      cursor: pointer; background: #fff !important;
      color: #000 !important; border: 1px solid #ccc;
      margin-left: 5px;
    }

    .badge {
      padding: 4px 8px;
      border-radius: 6px;
      color: white;
      font-size: 11px;
      margin-left: 6px;
    }
    .gold { background: #d4af37; }
    .silver { background: #c0c0c0; color: black; }
    .bronze { background: #cd7f32; }
  </style>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>

  <div class="container">

    <h2>Extended Game Score Leaderboard</h2>

    <label>Team Name:</label>
    <input type="text" id="teamName" placeholder="Enter team name" />

    <label>Game Name:</label>
    <input type="text" id="gameName" placeholder="Enter game name" />

    <label>Score:</label>
    <input type="number" id="gameScore" placeholder="Enter score" />

    <label>Time Taken (in minutes):</label>
    <input type="number" id="timeTaken" placeholder="Enter time in minutes" />

    <button onclick="addScore()">Add / Update Score</button>

    <table>
      <thead>
        <tr>
          <th>Rank</th>
          <th>Team</th>
          <th>Total Score</th>
          <th>Total Time (min)</th>
          <th>Games Played</th>
        </tr>
      </thead>
      <tbody id="leaderboardBody"></tbody>
    </table>

  </div>

  <!-- Charts Section -->
  <div class="container" style="margin-top:35px;">
    <h3>Leaderboard Visual Charts</h3>

    <canvas id="scoreChart" style="margin-top:20px; width:100%; max-height:350px;"></canvas>
    <canvas id="timeChart" style="margin-top:40px; width:100%; max-height:350px;"></canvas>
  </div>


  <script>
    let teams = {};
    let editingTeam = null;
    let editingIndex = null;

    function addScore() {
      const name = document.getElementById('teamName').value.trim();
      const game = document.getElementById('gameName').value.trim();
      const score = parseInt(document.getElementById('gameScore').value);
      const time = parseInt(document.getElementById('timeTaken').value);

      if (!name || !game || isNaN(score) || isNaN(time)) {
        alert("Fill all fields correctly.");
        return;
      }

      if (!teams[name]) {
        teams[name] = { totalScore: 0, totalTime: 0, games: [] };
      }

      if (editingTeam === name && editingIndex !== null) {
        let old = teams[name].games[editingIndex];
        teams[name].totalScore -= old.score;
        teams[name].totalTime -= old.time;

        teams[name].games[editingIndex] = { game, score, time };
        editingTeam = null;
        editingIndex = null;
      } else {
        teams[name].games.push({ game, score, time });
      }

      teams[name].totalScore += score;
      teams[name].totalTime += time;

      saveData();
      renderLeaderboard();
    }

    function editGame(team, index) {
      let g = teams[team].games[index];
      document.getElementById('teamName').value = team;
      document.getElementById('gameName').value = g.game;
      document.getElementById('gameScore').value = g.score;
      document.getElementById('timeTaken').value = g.time;

      editingTeam = team;
      editingIndex = index;
    }

    function deleteGame(team, index) {
      let g = teams[team].games[index];
      teams[team].totalScore -= g.score;
      teams[team].totalTime -= g.time;
      teams[team].games.splice(index, 1);

      saveData();
      renderLeaderboard();
    }

    function renderLeaderboard() {
      const leaderboard = Object.entries(teams)
        .map(([name, data]) => ({ name, ...data }))
        .sort((a, b) => {
          if (b.totalScore !== a.totalScore) return b.totalScore - a.totalScore;
          return a.totalTime - b.totalTime;
        });

      const tbody = document.getElementById('leaderboardBody');
      tbody.innerHTML = '';

      leaderboard.forEach((team, index) => {
        let badge = "";
        if (index === 0) badge = `<span class="badge gold">1st</span>`;
        else if (index === 1) badge = `<span class="badge silver">2nd</span>`;
        else if (index === 2) badge = `<span class="badge bronze">3rd</span>`;

        const gamesList = team.games
          .map((g, i) => `
            â€¢ ${g.game}: ${g.score} pts, ${g.time} min
            <button class="action-btn" onclick="editGame('${team.name}', ${i})">Edit</button>
            <button class="action-btn" onclick="deleteGame('${team.name}', ${i})">Delete</button>
          `)
          .join("<br>");

        tbody.innerHTML += `
          <tr>
            <td>${index + 1} ${badge}</td>
            <td>${team.name}</td>
            <td>${team.totalScore}</td>
            <td>${team.totalTime}</td>
            <td class="games-cell">${gamesList}</td>
          </tr>
        `;
      });

      updateCharts();
    }

    /* -----------------------
       Visual Charts
    ----------------------- */
    let scoreChartInstance = null;
    let timeChartInstance = null;

    function updateCharts() {
      const names = [];
      const scores = [];
      const times = [];

      Object.entries(teams)
        .sort((a, b) => b[1].totalScore - a[1].totalScore)
        .forEach(([name, data]) => {
          names.push(name);
          scores.push(data.totalScore);
          times.push(data.totalTime);
        });

      if (scoreChartInstance) scoreChartInstance.destroy();
      if (timeChartInstance) timeChartInstance.destroy();

      const colorPalette = [
        "#ff6384", "#36a2eb", "#ffcd56", "#4bc0c0",
        "#9966ff", "#ff9f40", "#66ff66", "#ff6699"
      ];

      scoreChartInstance = new Chart(document.getElementById("scoreChart"), {
        type: "bar",
        data: {
          labels: names,
          datasets: [{
            label: "Total Score",
            data: scores,
            backgroundColor: colorPalette,
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: { display: true, text: "Team Scores", font: { size: 18 } }
          },
          scales: { y: { beginAtZero: true } }
        }
      });

      timeChartInstance = new Chart(document.getElementById("timeChart"), {
        type: "bar",
        data: {
          labels: names,
          datasets: [{
            label: "Total Time (Minutes)",
            data: times,
            backgroundColor: colorPalette,
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: { display: true, text: "Time Taken (Minutes)", font: { size: 18 } }
          },
          scales: { y: { beginAtZero: true } }
        }
      });
    }

    /* -----------------------
       Save / Load
    ----------------------- */
    function saveData() {
      localStorage.setItem("leaderboard_extended_v1.1", JSON.stringify(teams));
    }

    window.onload = function () {
      const saved = localStorage.getItem("leaderboard_extended_v1.1");
      if (saved) teams = JSON.parse(saved);
      renderLeaderboard();
    };
  </script>

</body>
</html>
